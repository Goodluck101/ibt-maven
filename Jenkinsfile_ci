pipeline{
    agent any

    tools{
        maven 'maven_3.8'
    }
    stages{
       stage('Git checkout'){
          steps{
           git branch: 'feature_kay', changelog: false, credentialsId: 'kay_cred', poll: false, url: 'https://github.com/IBT-learning/ibt-maven.git'
          }
       }
       stage('Validate'){
          steps{
              withMaven(maven: 'maven_3.9.3') {
                 sh 'mvn --version'
                 sh 'mvn validate'
              }
          }
      }
      stage('Compile'){
          steps{
              sh 'mvn --version'
              sh 'mvn compile'
          }
      }
      stage('Test'){
               steps{
                   sh 'mvn --version'
                   sh 'mvn test'
               }
      }
      stage('Package'){
                     steps{
                         sh 'mvn --version'
                         sh 'mvn package'
              }
      }

      stage('upload Artifactory'){
       steps{
        withCredentials([file(credentialsId: 'maven_secretfile_kayshow', variable: 'maven_settings_kayshow04')]) {
            sh 'mvn deploy' -s $maven_settings_kayshow04'
        }
       }
      }
    }
}