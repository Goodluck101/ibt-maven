pipeline{
  agent any
  stages{
     stage('hello world'){
       steps{
        echo "hello world, my name is oladimeji Akisanya"
       }
     } //stage 1
     stage('hi'){
         steps{
          echo "love my world"
         }
     } // stages 2
     stage('download fro GIT'){
       steps{
             git branch: 'demo1', changelog: false, credentialsId: 'GitHub_cred_oakisanyao', poll: false, url: 'https://github.com/akisanyao/git.git'
       }
     } //stage 3

     stage('validate'){
              steps{
                 withMaven(maven:'maven_3.9.3') {
                     sh 'mvn validate'
                 }
              }

            }
            stage('compile'){
                     steps{
                         sh 'mvn compile'
                     }

            }
             stage('test'){
                            steps{

                                sh 'mvn test'
                            }

            }

            stage ('sonarQube scan'){
             environment{
                sonarScan = tool 'ibt-sonarqube'
             }
                 steps{
                       withSonarQubeEnv(credentialsId: 'student-sonar-token', installationName: 'IBT sonarqube') {
                         sh "${env.sonarScan}/bin/sonar-scanner"


                       }

                 }

            }

             stage('package'){
                            steps{
                                sh 'mvn --version'
                                sh 'mvn package'
                            }

             }
             stage('upload to artifactory'){
                           steps{
                             withCredentials([file(credentialsId: 'settings_mvn_oakisanya', variable: 'mvn_settings_oakisanya')]) {
                               sh 'mvn deploy -s $mvn_settings_oakisanya'
                             }

                           }
             }

             stage('upload to artifactory with config'){
                                   steps{
                                     configFileProvider([configFile(fileId: 'maven_setting_oakisanya', targetLocation: 'mvn_settings_managed', variable: 'mvn_settings_managed')]) {
                                       sh 'mvn deploy -s $mvn_settings_managed'
                                     }

                                   }
             }

             stage('Dependency Scan'){
               steps{
                  dependencyCheck additionalArguments: '''
                       -o "./"
                       -s "./"
                       -f "ALL"
                       --prettyPrint \'\'\', odcInstallation: \'dependency-check\'''', odcInstallation: 'dependency-check'
                  dependencyCheckPublisher pattern: 'dependency-check-report.xml'
               }
             }

  } //stages
} //pipeline